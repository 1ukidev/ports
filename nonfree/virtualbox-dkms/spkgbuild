# description	: Virtualbox host kernel modules
# depends	: dkms

name=virtualbox-dkms
version=6.1.22
release=1
_name=Oracle_VM_VirtualBox_Extension_Pack
_release=144080

source="http://download.virtualbox.org/virtualbox/$version/VirtualBox-${version}-${_release}-Linux_amd64.run
	dkms.conf"

build() {
	sh VirtualBox-${version}-${_release}-Linux_amd64.run --keep --noexec --target $PWD
	tar xf VirtualBox.tar.bz2 src/vboxhost/

	install -d $PKG/usr/src/

	cp -r src/vboxhost $PKG/usr/src/vboxhost-$version

	sed "s,@VERSION@,$pkgver," dkms.conf > $PKG/usr/src/vboxhost-$version/dkms.conf

	install -d $PKG/etc/modules-load.d/
	echo "# Load virtualbox modules at startup" > $PKG/etc/modules-load.d/virtualbox.conf
	echo "vboxdrv" >> $PKG/etc/modules-load.d/virtualbox.conf
	echo "vboxnetadp" >> $PKG/etc/modules-load.d/virtualbox.conf
	echo "vboxnetflt" >> $PKG/etc/modules-load.d/virtualbox.conf
}
