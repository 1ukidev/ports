# description	: QtWebEngine integrates chromium's web capabilities into Qt
# depends	: qt5 nss python2 libwebp libxslt opus ninja ffmpeg alsa-lib

name=qtwebengine
version=5.13.0
release=1
source=(https://download.qt.io/archive/qt/${version::4}/$version/submodules/$name-everywhere-src-$version.tar.xz
	qtwebengine-glibc-2.29.patch)
md5sum=(235ecc14211ba03ae7331c175c1b7c78
	b19475a807d02d7af5f0e7b170a5a7dd)

build() {
	cd $name-everywhere-src-$version

	( cd src/3rdparty/chromium
	patch -Np1 -i $SRC/qtwebengine-glibc-2.29.patch )

	find -type f -name "*.pr[io]" |
	  xargs sed -i -e 's|INCLUDEPATH += |&$$QTWEBENGINE_ROOT/include |'

	mkdir build
	cd    build

	test -n $MAKEFLAGS && export NINJAFLAGS+=" $MAKEFLAGS"
	
	qmake .. -- -proprietary-codecs -system-ffmpeg -webengine-icu
	make
	make INSTALL_ROOT=$PKG install

	find $PKG/usr/ -name \*.prl \
	   -exec sed -i -e '/^QMAKE_PRL_BUILD_DIR/d' {} \;
}
