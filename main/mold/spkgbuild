# description	: A Modern Linker"
# homepage	: https://github.com/rui314/mold
# depends	: cmake zlib mimalloc tbb

name=mold
version=1.3.0
release=1
source="$name-$version.tar.gz::https://github.com/rui314/mold/archive/v$version.tar.gz"

build() {
	cd $name-$version

	[ -f /usr/bin/clang ] && {
		export CC=clang
		export CXX=clang++
	}

	export SYSTEM_MIMALLOC=1
	export SYSTEM_TBB=1
	export LTO=1

	# use /usr/lib instead of /usr/libexec
        sed -i "s/libexec/lib/" Makefile

	make \
		CFLAGS="${CFLAGS}" \
		CXXFLAGS="${CXXFLAGS}" \
		PREFIX="/usr" \

	make DESTDIR=$PKG PREFIX="/usr" install
}


