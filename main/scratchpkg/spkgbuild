# description	: A simple package manager for Linux Distribution
# depends	: coreutils libarchive git

name=scratchpkg
version=20220702
release=1
backup="etc/scratchpkg.conf
	etc/scratchpkg.alias
	etc/scratchpkg.repo
	etc/scratchpkg.mask
	etc/revdep.conf"
scratchpkg_url=https://github.com/venomlinux/scratchpkg
source="https://github.com/venomlinux/scratchpkg/archive/6626017ff7d1cb7883b4ce8b248001995ff19e84.tar.gz
	$name.repo
	$name.conf
	portsync
	temporary_workaround_for_coreutils.patch"

build() {
	if [ -f /etc/venom-release ]; then
		prerelease=$(cat /etc/venom-release)
	else
		prerelease="unknown-release"
	fi

	cd $name-6626017ff7d1cb7883b4ce8b248001995ff19e84

	for s in $SRC/*; do
		case $s in
			*.patch) patch -Np1 -i $s;;
		esac
	done

	DESTDIR=$PKG ./INSTALL.sh
	install -m644 $SRC/$name.repo $PKG/etc/$name.repo
	install -m644 $SRC/$name.conf $PKG/etc/$name.conf
	install -m755 $SRC/portsync $PKG/usr/bin/portsync_old

	sed "s/@RLS@/${prerelease}/g" -i $PKG/etc/$name.repo
}
